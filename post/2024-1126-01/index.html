<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <script
    type="application/javascript"
    src='https://0xo7.github.io/js/theme-mode.js'
  ></script>
  <link rel="stylesheet" href='https://0xo7.github.io/css/frameworks.min.css' />
  <link rel="stylesheet" href='https://0xo7.github.io/css/github.min.css' />
  <link rel="stylesheet" href='https://0xo7.github.io/css/github-style.css' />
  <link rel="stylesheet" href='https://0xo7.github.io/css/light.css' />
  <link rel="stylesheet" href='https://0xo7.github.io/css/dark.css' />
  <link rel="stylesheet" href='https://0xo7.github.io/css/syntax.css' />
  
  <link rel="stylesheet" href="/custom.css" />
  
  <title>
    Win10 系统封装教程 | 0xo7&#39;s Blog
  </title>
  
  <link rel="icon" type="image/x-icon" href="/images/github-mark.png" />
  
  <meta name="theme-color" content="#1e2327" />

  
  <meta
  name="description"
  content="本文为系统封装教程，旨在优化企业内系统安装时间，其中包含了封装系统中的各种注意事项 &amp;hellip;"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://0xo7.github.io/post/2024-1126-01/" />


<meta name="twitter:card" content="summary" />
<meta
  name="twitter:title"
  content="Win10 系统封装教程 - 0xo7&#39;s Blog"
/>
<meta
  name="twitter:description"
  content="本文为系统封装教程，旨在优化企业内系统安装时间，其中包含了封装系统中的各种注意事项 &amp;hellip;"
/>
<meta name="twitter:site" content="https://0xo7.github.io/" />
<meta name="twitter:creator" content="" />
<meta
  name="twitter:image"
  content="https://0xo7.github.io/"
/>


<meta
  property="og:type"
  content="article"
/>
<meta
  property="og:title"
  content="Win10 系统封装教程 - 0xo7&#39;s Blog"
/>
<meta
  property="og:description"
  content="本文为系统封装教程，旨在优化企业内系统安装时间，其中包含了封装系统中的各种注意事项 &amp;hellip;"
/>
<meta property="og:url" content="https://0xo7.github.io/post/2024-1126-01/" />
<meta property="og:site_name" content="Win10 系统封装教程" />
<meta
  property="og:image"
  content="https://0xo7.github.io/"
/>
<meta property="og:image:width" content="2048" />
<meta property="og:image:height" content="1024" />

<meta property="article:published_time" content="2024-11-26 18:51:59 &#43;0800 &#43;0800" />















</head>


<body>
  

<style>
  .height-limitation {
    max-height: 300px;
    overflow-y: scroll;
  }

  .loader {
    border: 4px solid #f3f3f3;
    border-bottom: 4px solid var(--color-fg-muted);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
</style>

<div style="position: relative">
  <header
    class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on"
  >
    <div
      class="Header-item mobile-none"
      style="margin-top: -4px; margin-bottom: -4px"
    >
      <a class="Header-link" href="https://0xo7.github.io/" aria-label="Home">
        <svg
          class="octicon"
          height="32"
          viewBox="0 0 16 16"
          version="1.1"
          width="32"
        >
          <path
            fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
          ></path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button
        class="Header-link btn-link js-details-target"
        type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'"
        aria-label="Search"
      >
        <svg
          height="24"
          class="octicon octicon-three-bars"
          viewBox="0 0 16 16"
          version="1.1"
          width="24"
        >
          <path
            fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"
          ></path>
        </svg>
      </button>
    </div>
    <div
      style="display: none"
      id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex"
    >
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to"
      >
        <div class="position-relative">
          <form
            target="_blank"
            action="https://www.google.com/search"
            accept-charset="UTF-8"
            method="get"
            autocomplete="off"
          >
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"
            >
              <input
                type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q"
                value=""
                placeholder="Search"
                autocomplete="off"
              />
              <input type="hidden" name="q" value="site:https://0xo7.github.io/" />
              <div
                class="js-jump-to-suggestions-container jump-to-suggestions overflow-hidden position-absolute"
              >
                <div
                  id="search-progress"
                  class="d-none color-bg-primary no-underline p-2"
                  role="progress"
                  aria-selected="false"
                >
                  <div class="loader"></div>
                </div>

                <ul
                  id="jump-to-results"
                  role="listbox"
                  class="Box border-0 p-0 m-0 js-navigation-container jump-to-suggestions-results-container js-jump-to-suggestions-results-container js-active-navigation-container height-limitation"
                ></ul>
              </div>
            </label>
          </form>
        </div>
      </div>
    </div>

    <div
      class="Header-item Header-item--full flex-justify-center d-md-none position-relative"
    >
      <a class="Header-link" href="https://0xo7.github.io/" aria-label="Home">
        <svg
          class="octicon octicon-mark-github v-align-middle"
          height="32"
          viewBox="0 0 16 16"
          version="1.1"
          width="32"
        >
          <path
            fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
          ></path>
        </svg>
      </a>
    </div>
    <div class="Theme-switcher Header-item" style="margin-right: 0">
      <span
        role="button"
        class="Header-link no-select"
        onclick="switchTheme()"
        style="cursor: pointer"
        aria-label="Switch theme"
      >
        <svg
          style="fill: var(--color-profile-color-modes-toggle-moon)"
          class="no-select"
          viewBox="0 0 16 16"
          version="1.1"
          width="16"
          height="16"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z"
          ></path>
        </svg>
      </span>
    </div>
  </header>
</div>

  
<script>
    (function(){
        var correctPassword = '2420011244';
        var storedPassword = localStorage.getItem('pagePassword');

        function verifyPassword(password) {
            return password === correctPassword;
        }

        function promptPassword() {
            var userPassword = prompt('请输入文章密码');
            if (verifyPassword(userPassword)) {
                localStorage.setItem('pagePassword', userPassword);
            } else {
                alert('密码错误！');
                if (history.length === 1) {
                    window.opener = null;
                    window.open('', '_self');
                    window.close();
                } else {
                    history.back();
                }
            }
        }

        if (!verifyPassword(storedPassword)) {
            promptPassword();
        }
    })();
</script><script type="text/javascript" src="/js/initimage.js"></script>



<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://0xo7.github.io/">
                  <img class=" avatar-user"
                    src="/images/avatar.png"
                    width="32" height="32" alt="Thunnus"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://0xo7.github.io/">Thunnus</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://0xo7.github.io/post/2024-1126-01/">Win10 系统封装教程</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 26 Nov 2024 18:51:59 &#43;0800"
                    class="no-wrap">
                    Tue, 26 Nov 2024 18:51:59 &#43;0800</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Tue, 31 Dec 2024 08:34:28 &#43;0000"
                    class="no-wrap">
                    Tue, 31 Dec 2024 08:34:28 &#43;0000</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      1108 Words
                    <span class="file-info-divider"></span>
                                        5 min

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
  
    
       
       
       
       
      
        
        
        
       
      <a class="muted-link mr-3" href="/tags/%E6%A1%8C%E9%9D%A2%E8%BF%90%E7%BB%B4">
        <span class="repo-language-color" style="background-color: #9a9b9c"></span>
        桌面运维
      </a>
    
  

                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="精简系统母盘">精简系统母盘</h1>
<p>在企业中大批量应用的时候，并不是越精简越好，更多的是要考虑稳定性质，MSMG ToolKit 精简方式是以系统稳定为主，使用的是微软官方的组件精简方式，系统稳定是长处，系统体积不是优势。而 NTLITE 暴力删除精简方式，系统大小是优势，但是稳定性其实不是优势，日常肯定没有任何问题。</p>
<h2 id="msmg-toolkithttpsmsmgtoolkitin"><a href="https://msmgtoolkit.in/">MSMG Toolkit</a></h2>
<h3 id="精简组件">精简组件</h3>
<h3 id="添加-net-35">添加 .NET 3.5</h3>
<h3 id="导入注册表">导入注册表</h3>
<h3 id="封装成-wmi-和-ios">封装成 WMI 和 IOS</h3>
<h2 id="ntlitehttpswwwntlitecom"><a href="https://www.ntlite.com/">NTLite</a></h2>
<p>NTLite 精简母盘采用暴力删除的方式，可精简的选项和组件非常多。由于 NTLite 的收费性质，网上所有的破解版本都不能支持比较新的 win10 版本，这里暂时不选用，实际 NTLite 是精简系统母盘非常棒的工具，价格实际也不贵，小鱼儿yr拼车价格100一年。</p>
<h1 id="母盘安装及优化">母盘安装及优化</h1>
<h1 id="安装常用软件">安装常用软件</h1>
<h1 id="封装前的优化">封装前的优化</h1>
<h1 id="使用-es5s-进行封装">使用 ES5S 进行封装</h1>
<h1 id="其它相关教程">其它相关教程</h1>
<h2 id="修改和关联默认应用">修改和关联默认应用</h2>
<h3 id="setuserfta">SetUserFTA</h3>
<h3 id="setdefaultbrowser">SetDefaultBrowser</h3>
<h3 id="注册表研究">注册表研究</h3>
<h2 id="干掉-ucpdsys-驱动">干掉 UCPD.sys 驱动</h2>
<p>IT之家 4 月 8 日消息，微软今年 2 月面向 Windows 10 用户推送 KB5034763 更新、面向 Windows 11 用户推送 KB5034765 更新，其中一项调整是阻止用户使用软件或者修改注册表方式，配置系统的默认浏览器。</p>
<p>IT之家 3 月 26 日已经报道过这个问题，现在关于这个问题的更多细节被披露。IT 顾问 Christoph Kolbicz 率先发现微软的这项调整，安装 2 月更新之后导致其 SetUserFTA 和 SetDefaultBrowser 程序无法正常使用。</p>
<p>SetUserFTA 是一个命令行程序，可让 Windows 管理员通过登录脚本和其他方法更改文件关联；SetDefaultBrowser 的工作原理类似，但只能用于更改 Windows 中的默认浏览器。</p>
<h3 id="背景介绍">背景介绍</h3>
<p>微软自 Windows 8 系统开始就引入了新的安全机制，为了防止恶意软件和恶意脚本篡改，将文件扩展名、URL 协议与默认程序关联起来。</p>
<p>微软的这一新机制，将文件扩展名或 URL 协议关联，存储在 UserChoice 注册表键值下。</p>
<p>例如，分配给 HTTPS URL 协议的默认网络浏览器的路径如下：</p>
<pre tabindex="0"><code>Windows Registry Editor Version 5.00
[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\Shell\Associations\UrlAssociations\https\UserChoice]
&#34;ProgId&#34;=&#34;ChromeHTML&#34;
&#34;Hash&#34;=&#34;N3eikAB1HhI=&#34;
</code></pre><p>如果未使用正确的哈希值，Windows 将忽略注册表值，并使用该 URL 协议的默认程序，即 Microsoft Edge。</p>
<p><a href="https://kolbi.cz/blog/">Kolbicz</a> 逆向设计了这种 Hashing 算法，创建了 SetUserFTA 和 SetDefaultBrowser 程序来更改默认程序。</p>
<h3 id="2024-年-2-月新调整">2024 年 2 月新调整</h3>
<p>不过 Windows 10 和 Windows 11 系统安装 2 月更新之后，Kolbicz 注意到这些注册表键值现在已被锁定，在 Windows 设置之外修改时会出现错误。</p>
<p>例如，使用 Windows 注册表编辑器修改这些设置时会出现错误，提示“无法编辑哈希值：错误写入值的新内容”。</p>
<p>经过进一步研究，<a href="https://kolbi.cz/blog/">Kolbicz</a>  发现微软在二月份的更新中引入了一个新的 Windows 过滤驱动程序（C:\Windows\System32\drivers\UCPD.sys）。</p>
<p>该驱动程序被称为 &ldquo;用户选择保护驱动程序&rdquo;，加载后的作用就是阻止对 UserChoice 注册表项的访问。</p>
<h3 id="阻止-ucdp-生效">阻止 UCDP 生效</h3>
<p>Kolbicz 在一篇博文中解释说，虽然不能卸载驱动程序，但可以在注册表中禁用它。</p>
<h2 id="win10-解决删除部分文件需要-trustedinstaller权限">Win10 解决删除部分文件需要 trustedinstaller权限</h2>
<p>win10 在删除 UCDP.sys 文件的时候，需要trustedinstaller权限。</p>
<p><img src="2024-1126-01%5Cimage-20241204202107997.png" alt="image-20241204202107997"></p>
<h2 id="注册表优化">注册表优化</h2>
<h3 id="更改系统休眠时间">更改系统休眠时间</h3>
<h3 id="更改锁屏时间">更改锁屏时间</h3>
</article>
              </div>

              
            </div>
          </div>
        </div>
      </div>

      <div class="pagination-nav">
        <div class="pagination-button next-post">
          
          <div>«&nbsp;</div><a class="pagination-link link-reverse" href="https://0xo7.github.io/post/2024-1211-01/"> Qexo 搭建指南</a>
          
        </div>
        
        <div class="pagination-button previous-post">
          
          <a class="pagination-link link-reverse" href="https://0xo7.github.io/post/2024-1103-01/">Runasspc 使用技巧&nbsp;</a><div> »</div>
          
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://0xo7.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://0xo7.github.io/css/toc.css' />


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://0xo7.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://0xo7.github.io/js/github-style.js"></script>

<script src="https://0xo7.github.io/js/mark.es6.min.js"></script>







</html>