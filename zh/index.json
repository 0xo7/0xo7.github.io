[{"content":"基础知识补充：\n查看环境变量，也可以cmd下输入set来查看\n查看环境变量，也可以用win32api查看，如下\n远程下载exe，然后执行\nSW_HIDE 是隐藏窗口，而测试的时候，可以用 SH_SHOW 显示窗口，正常会报毒，加壳可以避免一定程度报毒\n除了用 WinExec 外创建进程，还可以用 CreateProcess 创建进程\n1 2 3 4 5 6 7 8 9 10 11 12 13 #define _CRT_SECURE_NO_WARNINGS #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; void main() { STARTUPINFO info; GetStartupInfo(\u0026amp;info); PROCESS_INFORMATION pinfo; CreateProcess(NULL, \u0026#34;c:/fuff.exe\u0026#34;, NULL, NULL, NULL,NULL,NULL,NULL,\u0026amp;info,\u0026amp;pinfo); } 使用 CreateProcess 时可以设置为挂起状态，如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 #define _CRT_SECURE_NO_WARNINGS #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; void main() { STARTUPINFO info; GetStartupInfo(\u0026amp;info); PROCESS_INFORMATION pinfo; CreateProcess(NULL, \u0026#34;c:/fuff.exe\u0026#34;, NULL, NULL, NULL,CREATE_SUSPENDED,NULL,NULL,\u0026amp;info,\u0026amp;pinfo); ResumeThread(pinfo.hThread); } 还可以设置DEBUG_PROCESS，这样进程就可以被调试，这样设置后，当前创建进程的子进程也可以被调试，如果设置为 DEBUG_ONLY_THIS_PROCESS 则仅调试当前创建的进程，一般同时指定这两个参数就行，如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 #define _CRT_SECURE_NO_WARNINGS #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; void main() { STARTUPINFO info; GetStartupInfo(\u0026amp;info); PROCESS_INFORMATION pinfo; CreateProcess(NULL, \u0026#34;c:/fuff.exe\u0026#34;, NULL, NULL, NULL, DEBUG_PROCESS | DEBUG_ONLY_THIS_PROCESS,NULL,NULL,\u0026amp;info,\u0026amp;pinfo); ResumeThread(pinfo.hThread); } 进程读写，修改游戏内存，以植物大战僵尸为案例\n由于在尝试的时候 findwindow 没有找到窗口（很奇怪），所以直接用spy查找到实际句柄\n然后ce查找内存地址\n最后可以通过 ReadProcessMemory 读取内存地址的值，可以打印出 150 个太阳\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #define _CRT_SECURE_NO_WARNINGS #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; void main() { // HANDLE 窗口句柄 = FindWindow(NULL, \u0026#34;植物大战僵尸中文版\u0026#34;); HWND 窗口句柄 = (HWND)0x002303BC; DWORD p = 0; GetWindowThreadProcessId(窗口句柄, \u0026amp;p); HANDLE hd = OpenProcess(PROCESS_ALL_ACCESS, TRUE, p); int* lp = 0x15F73908; int* num = malloc(4); ReadProcessMemory(hd,lp,num,4,NULL); printf(\u0026#34;%d\u0026#34;, *num); } 修改太阳为 10000\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #define _CRT_SECURE_NO_WARNINGS #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; void main() { // HANDLE 窗口句柄 = FindWindow(NULL, \u0026#34;植物大战僵尸中文版\u0026#34;); HWND 窗口句柄 = (HWND)0x002303BC; DWORD p = 0; GetWindowThreadProcessId(窗口句柄, \u0026amp;p); HANDLE hd = OpenProcess(PROCESS_ALL_ACCESS, TRUE, p); int* lp = 0x15F73908; int* num = malloc(4); ReadProcessMemory(hd, lp, num, 4, NULL); *num = 10000; WriteProcessMemory(hd, lp, num, 4, NULL); printf(\u0026#34;%d\u0026#34;, *num); } 利用 CreateToolhelp32Snapshot 遍历 tasklist 所有进程，CreateToolhelp32Snapshot 相当于把 tasklit 显示出的当前进程截图，然后返回，但CreateToolhelp32Snapshot 返回的进程不是实时的\nCreateToolhelp32Snapshot 可以遍历所有进程，也可以遍历一个进程里面的所有模块或者堆\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;TlHelp32.h\u0026gt; void main() { HANDLE hd = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); PROCESSENTRY32 pe; pe.dwSize = sizeof(pe); Process32First(hd, \u0026amp;pe); while (Process32Next(hd, \u0026amp;pe)) { wprintf(L\u0026#34;%s\t%d\\n\u0026#34;, pe.szExeFile, pe.th32ProcessID); } } 关闭计算器进程\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;TlHelp32.h\u0026gt; int main() { char* name = \u0026#34;CalculatorApp.exe\u0026#34;; HANDLE hd = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); PROCESSENTRY32 pe; pe.dwSize = sizeof(pe); Process32First(hd, \u0026amp;pe); while (Process32Next(hd, \u0026amp;pe)) { HANDLE 进程 = OpenProcess(PROCESS_ALL_ACCESS, TRUE, pe.th32ProcessID); if (进程 != NULL) { if (strcmp(name, pe.szExeFile) == 0) { if (TerminateProcess(进程, 0)) { printf(\u0026#34;Terminated process: %s\\n\u0026#34;, pe.szExeFile); } else { DWORD error = GetLastError(); printf(\u0026#34;Failed to terminate process: %lu\\n\u0026#34;, error); } } CloseHandle(进程); } else { DWORD error = GetLastError(); wprintf(L\u0026#34;Failed to open process: %lu, %s\\n\u0026#34;, error, pe.szExeFile); } } CloseHandle(hd); return 0; } 这里关闭失败了，结果如下，5 表示权限不够，可能要提权才能够关闭（不是很清楚）\n打印计算器进程的模块\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;TlHelp32.h\u0026gt; void main() { char name[30] = \u0026#34;CalculatorApp.exe\u0026#34;; HANDLE hd = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, NULL); MODULEENTRY32 module; module.dwSize = sizeof(module); Module32First(hd, \u0026amp;module); while (Module32Next(hd, \u0026amp;module)) { wprintf(L\u0026#34;%s\\n\u0026#34;, module.szExePath); } } 编译如下汇编代码\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 .386 .model flat, stdcall option casemap:none include D:\\masm32\\include\\user32.inc include D:\\masm32\\include\\windows.inc include D:\\masm32\\include\\kernel32.inc .data Err db \u0026#39;乃子哥哥爱吃槟榔\u0026#39;,0 Ok db \u0026#39;乃子哥哥爱看黄色\u0026#39;,0 caption db \u0026#39;乃子哥哥yyds\u0026#39;,0 .code fn proc xor eax,eax .if eax invoke MessageBoxA, NULL, addr Ok, addr caption, MB_OK .elseif invoke MessageBoxA, NULL, addr Err, addr caption, MB_ICONSTOP .endif ret fn endp start: invoke fn invoke ExitProcess, 0 end start 然后用ollylce调试\n注意：\n多次重复用ollylce加载发现je跳转的地址始终不发现变化，pe的exe文件反汇编后开始的地址短时间内不会发生改变。\n但对于dll文件，dll在物理内存中只有一份，dll文件是通过分页机制映射到虚拟内存中的，虚拟地址空间是隔离的，但是如果虚拟内存空间被占用了，那么就需要重定位，所以dll文件反汇编的开始地址并不一定是相同的，可能发生变化，这样我们就需要遍历整个模块的空间来找到起始地址\n但是由于这里是 exe 文件，所以短时间内程序入口地址不会变化，即 0x0059206B 不会变化，所以0x00592040肯定也不会变化，那么如果我们能够读取 0x00592040的地址对应的值1574（小端存储，7415也就是1574），并且修改成 9090 （也就是nop），那么就能够模仿上面在ce 中调试修改的操作，也就相当于补丁\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #define _CRT_SECURE_NO_WARNINGS #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;tchar.h\u0026gt; void main() { STARTUPINFO info; GetStartupInfo(\u0026amp;info); PROCESS_INFORMATION pinfo; if (CreateProcess(_T(\u0026#34;C:\\\\MASM.exe\u0026#34;), NULL, NULL, NULL, NULL, NULL, NULL, NULL, \u0026amp;info, \u0026amp;pinfo)) { printf(\u0026#34;进程创建成功\\n\u0026#34;); } else { DWORD error = GetLastError(); printf(\u0026#34;进程创建失败，错误码: %d\\n\u0026#34;, error); } void* p = 0x00592040; short oldbyte = 0x1574; short* newbyte = malloc(2); HANDLE hd = OpenProcess(PROCESS_ALL_ACCESS, TRUE, pinfo.dwProcessId); ReadProcessMemory(hd, p, newbyte, 2, NULL); if (oldbyte != *newbyte) { printf(\u0026#34;程序版本不对，无法添加补丁\u0026#34;); } else { *newbyte = 0x9090; WriteProcessMemory(hd, p, newbyte, 2, NULL); } } 执行结果如下：\n对 exe 进行upx加壳后，再用OllyICE进行F8单步调试，则发现一直在来回跳，无法继续往下执行（加壳就是防止反调试）\n以前的壳分为两种：\n一种是专门用于把代码压缩，降低可执行文件体积，比如压缩后是 123.exe，那么 123.exe 中当然还有一个解压缩代码 第二种就是对代码进行加密 现在的壳一般同时具备压缩和加密两种特性\n如何对加壳的程序进行打补丁 ？？\n把加壳后的程序拖入调试器，显示如下：\n解压缩代码的最后有一个跳转\n执行完解压缩代码后，进行跳转，再执行原本的程序\n如果直接跳过运行这段解压缩代码，直接从最后 jmp 开始执行\n最后结果如下，发现无法跳转到原来的程序中，所以解压缩代码无法跳过\n但是如果我们运行完解压缩代码后，再执行 jmp 跳转，那么就可以跳转到原来的程序中\n可以利用上面的思路，编写代码模拟上面调试器的过程，当解压缩代码执行完，然后跳转到原来的程序中后，再进行打补丁\n具体代码如下：\n","description":"","id":3,"section":"c","tags":["C"],"title":"进程遍历 | 内存补丁 | win32 api调试","uri":"https://ayuxy.github.io/zh/c/2023-1128-01/"},{"content":"汇编语言是直接工作在硬件之上的语言，首先要了解硬件系统的结构，才能有效应用汇编语言对其编程\n机器语言 ","description":"汇编语言是直接工作在硬件之上的语言，首先要了解硬件系统的结构，才能有效应用汇编语言对其编程","id":4,"section":"asm","tags":["8086汇编"],"title":"8086汇编基础","uri":"https://ayuxy.github.io/zh/asm/8086/2023-1121-05/"},{"content":"因 zzo 主题的原作者已停止更新，所以本文主要记录 zzo 主题的修复以及一些优化。由于不擅长前端，所以部分修复和优化代码可能存在一些问题\n添加自定义CSS文件 修改 params.toml 文件，如下：\n1 custom_css = [\u0026#34;scss/_custom.scss\u0026#34;] 在 assets/scss 下新建 _custom.scss 文件\n优化TOC 当 tocPosition = \u0026ldquo;outer\u0026rdquo; 时，如下，对 TOC 位置进行调整\n在 _custom.scss 文件中添加如下内容\n1 2 3 .toc[data-dir=ltr] { padding-left: 1.5rem !important; } 注：如果不想在 _custom.scss 修改，也可以修改 themes\\zzo\\assets\\sass\\components\\_toc.scss 文件的如下内容\n1 2 3 \u0026amp;[data-dir=\u0026#34;rtl\u0026#34;] { padding-right: 0.5rem; } 修改为\n1 2 3 \u0026amp;[data-dir=\u0026#34;rtl\u0026#34;] { padding-right: 1.5rem; } 优化文章内容样式 修改标签 在 _custom.scss 添加如下内容：\n1 2 3 4 .single__meta{ flex-direction: column !important; align-items: flex-start !important; } 修改 blockquote 在 _custom.scss 添加如下内容：\n1 2 3 4 .single__contents[data-dir=ltr] blockquote { margin: 0 0.5rem 1rem 0.5rem !important; padding: 0 0 0 1rem !important; } 修改段落间距 在 _custom.scss 添加如下内容：\n1 2 3 4 .single__contents p { margin: 0 0 1rem !important; padding: 0; } 修改主页样式 修改间距 在 _custom.scss 添加如下内容：\n1 2 3 4 5 6 .caption{ margin-top: 0.75rem !important; } .summary-classic__text { margin-top: 0.75rem !important; } 在 _custom.scss 添加如下内容：\n1 2 3 .summary-classic:not(:last-child) hr{ margin-bottom: 0.75rem !important; } 修改📌位置 修改 layouts/partials/summary/classic.html 里面的如下内容\n1 \u0026lt;h5 class=\u0026#34;title h5\u0026#34;\u0026gt;\u0026lt;a href=\u0026#39;{{ .Permalink }}\u0026#39;\u0026gt;{{- with .Params.pinned -}}{{ ($.Site.Params.pinIcon | safeHTML) | default \u0026#34;📌\u0026#34; }}\u0026amp;nbsp;{{- end -}}{{ .Title }}\u0026lt;/a\u0026gt; \u0026lt;/h5\u0026gt; 修改为如下\n1 \u0026lt;h5 class=\u0026#34;title h5\u0026#34;\u0026gt;\u0026lt;a href=\u0026#39;{{ .Permalink }}\u0026#39;\u0026gt;{{ .Title }}{{- with .Params.pinned -}}\u0026amp;nbsp;{{ ($.Site.Params.pinIcon | safeHTML) | default \u0026#34;📌\u0026#34; }}{{- end -}}\u0026lt;/a\u0026gt; \u0026lt;/h5\u0026gt; 修改archive页 修改 layouts/archive/list.html 里面的如下内容：\n1 2 3 \u0026lt;div class=\u0026#34;px py p2 single__contents\u0026#34;\u0026gt; {{ .Content }} \u0026lt;/div\u0026gt; 修改为如下\n1 2 3 4 5 {{ with .Content }} \u0026lt;div class=\u0026#34;px py p2 single__contents\u0026#34;\u0026gt; {{ . }} \u0026lt;/div\u0026gt; {{ end }} 修复英文溢出问题 https://www.runoob.com/w3cnote/css-nowrap-break-word.html\n在 _custom.scss 添加如下内容：\n1 2 3 .single__tags{ word-break:break-all !important; } 在 _custom.scss 添加如下内容：\n1 2 3 .list__sidebar[data-dir=ltr]{ word-break:break-all !important; } 在 _custom.scss 添加如下内容：\n1 2 3 .summary-classic__content{ word-break:break-all !important; } 在 _custom.scss 添加如下内容：\n1 2 3 .toc{ word-break:break-all !important; } 在 _custom.scss 添加如下内容：\n1 2 3 .terms__list{ word-break:break-all !important; } 在 _custom.scss 添加如下内容：\n1 2 3 .archive__li{ word-break:break-all !important; } 在 _custom.scss 添加如下内容：\n1 2 3 .basicflex-column{ word-break:break-all !important; } 处理图片问题 a 标签嵌套图片导致整体容器高度变大\n修复上面的问题，在 _custom.scss 添加如下内容：\n1 2 3 .summary-classic__image[data-ani=true]{ vertical-align: middle; }\t修复后如下：\n如果使用 svg 图片，且 svg 图片比较小，那么显示如下：\n为了让 svg 图片铺满容器，可以在 _custom.scss 添加如下内容：\n1 2 3 4 .summary-classic__image[data-ani=true]{ width: 100%; height: 100%;\t}\t侧边栏修改 修改最近发布文章 修改 posts-by-order.html 文件，修改后如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 {{ if ($.Param \u0026#34;enableSidebarPostsByOrder\u0026#34; | default false) }} {{ $filteredSections := .Site.Pages }} {{ range $.Param \u0026#34;notAllowedTypesInHomeSidebar\u0026#34; }} {{ $filteredSections = (where $filteredSections \u0026#34;Type\u0026#34; \u0026#34;!=\u0026#34; (lower .)) }} {{ end }} {{ $hasOrder := false }} {{ range first ($.Param \u0026#34;itemsPerCategory\u0026#34;) ($filteredSections.ByParam \u0026#34;order\u0026#34;) }} {{ if .Params.order }} {{ $hasOrder = true }} {{ end }} {{ end }} {{ if $hasOrder }} \u0026lt;div class=\u0026#34;sidebar-recent__title p2\u0026#34;\u0026gt;{{ i18n \u0026#34;posts-by-order\u0026#34; | default \u0026#34;TOP POSTS\u0026#34; }}\u0026lt;/div\u0026gt; \u0026lt;ul class=\u0026#34;sidebar-recent__ul\u0026#34;\u0026gt; {{ $orderedSections := (first ($.Param \u0026#34;itemsPerCategory\u0026#34;) ($filteredSections.ByParam \u0026#34;order\u0026#34;)) }} {{ range first ($.Param \u0026#34;itemsPerCategory\u0026#34;) $orderedSections.ByLastmod.Reverse }} {{ if .Params.order }} \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;{{ .RelPermalink }}\u0026#34; class=\u0026#34;sidebar-recent__a p2\u0026#34;\u0026gt;{{ .Title }}\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; {{ end }} {{ end }}\t\u0026lt;/ul\u0026gt; \u0026lt;hr class=\u0026#34;hr-fade sidebar-hr\u0026#34; /\u0026gt; {{ end }} {{ end }} 除此之外，还要修改 archetypes/default.md 文件为每篇文章添加上 order : true 参数\n通过 params.toml 文件里的 itemsPerCategory = 5 参数来控制最近更新文章的篇数\n修改Recently update间距 在 _custom.scss 添加如下内容：\n1 2 3 .sidebar-recent__title:nth-child(2).p2 { margin-top: 1.5rem; } 为文章里图片添加边框 在 _custom.scss 添加如下内容：\n1 2 3 .single__contents img { border: 1px solid #dfdfdf; } 修改摘要 当摘要长度超过2行的时候用省略号表示\n而当屏幕宽度小于 769 时，摘要超过1行的时候用省略号表示\n首先在 _custom.scss 添加如下内容：\n1 2 3 4 5 6 7 .summary-classic__text { overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; } 但是上面的 css 在 Webkit 浏览器内核下有作用，所以为了兼容其它浏览器内核，使用 clamp.js 实现，引入 clamp.js 后，在 _custom.js 下添加如下内容：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 document.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, function() { var paragraphs = document.querySelectorAll(\u0026#39;.summary-classic__text.p2\u0026#39;); // 判断屏幕宽度是否小于或等于 769 像素 if (window.matchMedia(\u0026#39;(max-width: 769px)\u0026#39;).matches) { // 屏幕宽度小于或等于 769px，设置 clamp 为 1 paragraphs.forEach(function(paragraph) { $clamp(paragraph, { clamp: 1, useNativeClamp: false, animate: false }); }); } else { // 屏幕宽度大于 769px，设置 clamp 为 2 paragraphs.forEach(function(paragraph) { $clamp(paragraph, { clamp: 2, useNativeClamp: false, animate: false }); }); } }); 修改间距 在 _custom.scss 添加如下内容：\n1 2 3 4 5 6 .list__main\u0026gt; .summary__container \u0026gt; .summary-classic:first-child \u0026gt; .summary-classic__flex-box { margin-top: 1.75rem; } .list__header--desc{ padding: 0rem !important; } 修改手机下首页图片显示效果 当屏幕宽度小于 769 的时候，不显示图片，在 _custom.js 中添加如下内容：\n1 2 3 4 5 6 7 8 9 10 var screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth; // 如果屏幕宽度小于769，则删除元素 if (screenWidth \u0026lt; 769) { // 获取所有.summary-classic__image-container元素 var elementsToRemove = document.querySelectorAll(\u0026#39;.summary-classic__image-container\u0026#39;); // 遍历所有元素并删除它们 elementsToRemove.forEach(function (element) { element.parentNode.removeChild(element); }); 修改文章中图片清晰度 参考：https://gohugo.io/templates/render-hooks/\n在 themes\\zzo\\layouts\\_default\\ 里面新建 _markup\\render-image.html 文件，在里面添加如下内容：\n1 2 3 4 5 6 7 8 9 10 \u0026lt;div class=\u0026#34;custom-image-container\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;{{ .Destination | safeURL }}\u0026#34; alt=\u0026#34;{{ .Text }}\u0026#34; {{ with .Title }}title=\u0026#34;{{ . }}\u0026#34;{{ end }} class=\u0026#34;custom-image-class lazyload\u0026#34; data-srcset=\u0026#34;{{ .Destination | safeURL }} 1.25x\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; 修改前：\n修改后：\n修改面包屑溢出 添加滑动条，在 _custom.scss 添加如下内容：\n1 2 3 .breadcrumb{ overflow-x:auto; } 处理 hugo server 警告 处理第一个告警，打开 _default/config.toml 文件，删除 [outputs] 下的：\n1 taxonomyTerm = [\u0026#34;HTML\u0026#34;, \u0026#34;RSS\u0026#34;, \u0026#34;SearchIndex\u0026#34;] 处理第二个告警，修改 _default/languages.toml，修改后文件如下：\n1 2 3 4 5 6 7 [zh] title = \u0026#34;Ayuxy\u0026#39;s Blog\u0026#34; languageName = \u0026#34;中文\u0026#34; weight = 1 contentdir = \u0026#34;content\u0026#34; [zh.params] languagedir = \u0026#34;ltr\u0026#34; 处理 minItemsToShowInTagCloud 参数 minItemsToShowInTagCloud 同时控制了侧边栏中系列、标签、分类中文章的最少数量，如果minItemsToShowInTagCloud=2，那么只有当系列、标签、分类中的文章数量至少为 2 的时候才会显示在侧边栏\n进行修改，让 minItemsToShowInTagCloud 控制标签，新增 minItemsToShowInCategoriesCloud 控制分类，新增 minItemsToShowInSeriesCloud 控制分类，\n修改 layouts/partials/taxonomy/taxonomy-categories.html 里面的 minItemsToShowInTagCloud 为 minItemsToShowInCategoriesCloud\n修改 layouts/partials/taxonomy/taxonomy-series.html 里面的 minItemsToShowInTagCloud 为 minItemsToShowInSeriesCloud\n同时在 param.toml 添加\n1 2 minItemsToShowInSeriesCloud = 5 minItemsToShowInCategoriesCloud = 3 在系列、标签、分类后面添加上相关的值，也就是配置文件里面 minItemsToShowInSeriesCloud 、 minItemsToShowInTagCloud 、minItemsToShowInCategoriesCloud 的值\n修改 layouts/partials/taxonomy/taxonomy-series.html 文件，在 {{ i18n \u0026ldquo;series\u0026rdquo; }} 后面添加上如下：\n1 {{ with .Site.Params.minItemsToShowInSeriesCloud }} ({{ . }}) {{ end }} 其它的 taxonomy-categories.html 、taxonomy-tags.html 文件同理\n修改文章标题间距 在 _custom.scss 添加如下内容：\n1 2 3 4 5 6 7 .single__contents h2{ margin: 3rem 0 1.5rem !important; } .single__contents h3 { margin: 2rem 0 1.25rem !important; } 修改字体 添加 data/font.toml，内容如下：\n1 2 title_font = \u0026#34;\\\u0026#34;LXGWWenKaiScreen\\\u0026#34;, sans-serif\u0026#34; content_font = \u0026#34;\\\u0026#34;LXGWWenKaiScreen\\\u0026#34;, sans-serif\u0026#34; 添加 assets\\scss\\font.css 文件，内容如下：\n1 2 3 4 5 @font-face { font-family: \u0026#39;LXGWWenKaiScreen\u0026#39;; src: url(\u0026#39;../fonts/LXGWWenKaiScreen.ttf\u0026#39;); font-style: normal; } 最后在 params.toml 文件中引入 font.css\n修改手机下间距 在 _custom.scss 添加如下内容：\n1 2 3 4 5 6 7 8 9 @media only screen and (max-width: 769px) { .caption { margin-top: 0.5rem !important; } .summary-classic__text { margin-top: 0.5rem !important; } } 手机下允许在单词内换行 在 _custom.scss 添加如下内容：\n1 2 3 4 5 @media only screen and (max-width: 769px) { .single__contents p { word-break: break-all; } } 修改 archive 页细节 在 _custom.scss 添加如下内容：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 .archive__type { padding-left: 5px; padding-right: 5px;\t} @media only screen and (min-width: 769px) { .archive__meta{ margin-top: 2.5px; } } .archive__key { width: 120px !important; } .archive__meta { min-width: 120px !important; max-width: 120px !important; } .archive__type { max-width: 70px !important; min-width: 70px !important;\t} 修改手机下的显示问题 对其修改，希望超出的部分不换行，而是左右滑动，在 _custom.scss 添加如下内容：\n1 2 3 4 5 6 7 8 9 10 11 @media only screen and (max-width: 769px) { .summary-classic__content{ overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; white-space: nowrap; } .summary-classic__content::-webkit-scrollbar { display: none; } } 添加后如下，可以左右欢动，但是摘要部分被截断了\n这是因为我们之前在_custom.scss 添加了如下内容：`\n1 2 3 4 5 6 7 .summary-classic__text { overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; } 将其修改为如下即可\n1 2 3 4 5 6 7 8 9 @media only screen and (min-width: 769px) { .summary-classic__text { overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; } } 修改后最终显示如下：\n一些可能用到的 css 调整整体页面大小\n1 2 3 body{ zoom:1.15 !important; } 添加about页面（标签墙） 添加 layouts\\_default\\tags-wall.html\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 {{ define \u0026#34;main\u0026#34; }} \u0026lt;style\u0026gt; #test { width: auto; height: auto; overflow: hidden !important; grid-area: 2/1/span 2/span 2; } #my-tags mark { position: initial!important; } \u0026lt;/style\u0026gt; \u0026lt;div id=\u0026#34;test\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;/js/tags-wall.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; Tags({ style: { fn: Style1, title: \u0026#39;你的名字\u0026#39;, animation: 0, scale: 0.48, randomScoreIfNoSetting: 1 // 如果是1，则如果未设置标签大小那么随机设置一个大小；否则使用默认大小5 }, text: ` 偶尔读书/10/关于我/https:\u0026amp;#47;\u0026amp;#47;cactus-mod.mantyke.icu\u0026amp;#47;books 有时电影/8/关于我/https:\u0026amp;#47;\u0026amp;#47;cactus-mod.mantyke.icu/movies 抽空游戏/7/关于我/https:\u0026amp;#47;\u0026amp;#47;cactus-mod.mantyke.icu/games 拜访朋友们/10/关于我/https:\u0026amp;#47;\u0026amp;#47;cactus-mod.mantyke.icu\u0026amp;#47;friends Nintendo Switch/8/是玩家 买书如山倒/\u0026amp;#47;/是读者 读书如抽丝/\u0026amp;#47;/是读者 `, rootDOM: document.getElementById(\u0026#39;test\u0026#39;) }) /** 使用说明 * 1. 将 index.js 引入自己的页面 * 2. 在引入上述脚本的下方插入代码： Tags({ style: { fn: Style1, title: \u0026#39;你的名字\u0026#39;, animation: 1 // 如果是1，则开启动画，否则不开启动画 scale: 1 // 放缩比例，即可调节标签和背景字的整体大小 }, text: ` \u0026lt;标签名\u0026gt;/\u0026lt;分数（0-10，决定标签大小）\u0026gt;/\u0026lt;标签类型\u0026gt;/\u0026lt;链接（点击标签会跳转到这个链接）\u0026gt; ... `, // 可以写在单独的文件中，如果写在的文件中，需要像上方那样使用fetch请求文件 rootDOM: document.getElementById(\u0026#39;目标载入dom的id\u0026#39;) }) */ \u0026lt;/script\u0026gt; \u0026lt;/script\u0026gt; {{ end }} 引入 static/js/tags-wall.js\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 ;(function () { const Color = { format (color) { if (color[0] === \u0026#39;#\u0026#39;) { return Utils.Color.switch16toRGB(color) } else if (color.indexOf(\u0026#39;rgb\u0026#39;) === 0) { return color } else { return Utils.Color.switch16toRGB(\u0026#39;#\u0026#39; + color) } }, switch16toRGB (color) { const r = parseInt(color.slice(1, 3), 16) const g = parseInt(color.slice(3, 5), 16) const b = parseInt(color.slice(5, 7), 16) return `rgb(${r},${g},${b})` }, getRGB (rgbColor) { return rgbColor.match(/rgb\\((\\d+),(\\d+),(\\d+)\\)/).slice(1) }, getGeryLevel (rgbColor) { const [R, G, B] = Utils.Color.getRGB(rgbColor) return R * 0.299 + G * 0.587 + B * 0.114 }, isDeep (rgbColor) { return Utils.Color.getGeryLevel(rgbColor) \u0026gt;= 192 } } const DOM = { setStyle (dom, styles) { if (!dom) return for (let sKey in styles) { dom.style[sKey] = styles[sKey] } }, create (tagName, properties) { const $ = document.createElement(tagName) if (properties.style) { DOM.setStyle($, properties.style) } for (const key in properties) { $[key] = properties[key] } return $ } } const Debounce = (time) =\u0026gt; { let timer return { exec (fn) { clearTimeout(timer) timer = setTimeout(fn, time) }, cancel () { clearTimeout(timer) } } } const Shuffle = (arr) =\u0026gt; arr.map(v =\u0026gt; ({ v, sort: Math.random()})).sort((a, b) =\u0026gt; a.sort - b.sort).map(v =\u0026gt; v.v) window.Utils = { Color, DOM, Debounce, Shuffle } })() const Tags = ({ style, text, rootDOM }) =\u0026gt; { style = style || { fn: Style1 } rootDOM = rootDOM || document.body if (!text) { throw new Error(\u0026#39;need text\u0026#39;) } /* Basic */ const $tags = Utils.DOM.create(\u0026#39;div\u0026#39;, { id: \u0026#39;my-tags\u0026#39; }) const $style = document.createElement(\u0026#39;style\u0026#39;) rootDOM.append($style, $tags) const preprocess = (txt) =\u0026gt; { return txt.split(\u0026#39;\\n\u0026#39;).slice(0, -1) .filter(item =\u0026gt; item.indexOf(\u0026#39;//\u0026#39;) !== 0 \u0026amp;\u0026amp; item !== \u0026#39;\u0026#39;) .map(item =\u0026gt; item.split(\u0026#39;/\u0026#39;).slice(0, 3).concat([item.split(\u0026#39;/\u0026#39;).slice(3).join(\u0026#39;/\u0026#39;)])) } const render = (data) =\u0026gt; { data.forEach(item =\u0026gt; $tags.innerHTML += genMarkHTML(item)) } const genMarkHTML = (item) =\u0026gt; { const [tag, score, type, link] = item const a = (text, link) =\u0026gt; `\u0026lt;a href=\u0026#34;${link}\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;${text}\u0026lt;/a\u0026gt;` Math.random() const randNum = Math.random() const computedScore = score || (style.randomScoreIfNoSetting ? Math.ceil(randNum * 10) : 5) return ` \u0026lt;mark data-rand=\u0026#34;${randNum}\u0026#34; data-score=\u0026#34;${computedScore}\u0026#34; class=\u0026#34;score-${computedScore}\u0026#34; data-type=\u0026#34;${type || \u0026#39;\u0026#39;}\u0026#34;\u0026gt; ${link ? a(tag, link) : tag} \u0026lt;/mark\u0026gt; ` } const filter = (data, type) =\u0026gt; data.filter(item =\u0026gt; item[2] === type) const Data = Utils.Shuffle(preprocess(text)) render(Data) style.rootDOM = rootDOM style.fn(Data, document.getElementsByTagName(\u0026#39;mark\u0026#39;), $tags, $style, style) } const Style1 = (data, marks, $tags, $style, Config) =\u0026gt; { marks = Array.prototype.slice.call(marks) Config.scale = Config.scale || 1 Utils.DOM.setStyle(Config.rootDOM, { position: \u0026#39;relative\u0026#39;, overflowX: \u0026#39;hidden\u0026#39; }) // const Size = [2.5, 3.5, 4.3, 5.1, 5.8, 6.5, 7, 7.5, 8, 8.4, 8.8] const Size = [2.5, 3.2, 3.9, 4.5, 5.1, 5.6, 6.1, 6.5, 6.9, 7.3, 7.7] const Color = (Array.isArray(Config.color) ? Config.color : [ \u0026#39;#e5e6e9\u0026#39;, \u0026#39;#e5e6e9\u0026#39;, \u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39;,\u0026#39;#e5e6e9\u0026#39; ]).map(color =\u0026gt; Utils.Color.format(color)) const FontSize = (size) =\u0026gt; size * 5 * Config.scale const getIntFromRand = (rand, end) =\u0026gt; Math.floor(parseFloat(rand) * end) const genBgColor = (randNum) =\u0026gt; Color[getIntFromRand(randNum, Color.length)] const genCSS = () =\u0026gt; { const genStyle = (index) =\u0026gt; `.score-${index} { font-size: ${FontSize(Size[index])}px }` return Array.from(Array(11)).map((_, i) =\u0026gt; genStyle(i)).join(\u0026#39;\\n\u0026#39;) } const genFontColor = (rgbBgColor) =\u0026gt; Utils.Color.isDeep(rgbBgColor) ? \u0026#39;#555\u0026#39; : \u0026#39;#fff\u0026#39; const $bg = document.createElement(\u0026#39;div\u0026#39;) Utils.DOM.setStyle($bg, { position: \u0026#39;absolute\u0026#39;, zIndex: \u0026#39;1\u0026#39;, fontSize: 11 * Config.scale + \u0026#39;rem\u0026#39;, color: \u0026#39;#26262e30\u0026#39;, display: \u0026#39;flex\u0026#39;, justifyContent: \u0026#39;center\u0026#39;, alignItems: \u0026#39;center\u0026#39;, width: \u0026#39;100%\u0026#39;, height: \u0026#39;100%\u0026#39;, top: \u0026#39;0\u0026#39;, left: \u0026#39;0\u0026#39; }) $bg.innerText = Config.title Config.rootDOM.appendChild($bg) const debounce = Utils.Debounce(200) marks.forEach($e =\u0026gt; { const bgColor = genBgColor(parseFloat($e.dataset.rand)) Math.random() Utils.DOM.setStyle($e, { backgroundColor: bgColor, color: genFontColor(bgColor), top: getIntFromRand(Math.random(), 90, Math.random()) + \u0026#39;%\u0026#39;, left: getIntFromRand(Math.random(), 85) + \u0026#39;%\u0026#39;, zIndex: (11 - $e.dataset.score).toString() }) Utils.DOM.setStyle($e.getElementsByTagName(\u0026#39;a\u0026#39;)[0], { color: genFontColor(bgColor), textDecoration: \u0026#39;none\u0026#39; }) if (Config.animation) { setTimeout(() =\u0026gt; { Utils.DOM.setStyle($e, { animation: `${Math.random() \u0026gt; 0.5 ? \u0026#39;float\u0026#39; : \u0026#39;float-reverse\u0026#39;} ${Math.random() * 5 + 7}s linear infinite` }) }, 5000 * Math.random()) } $e.onmouseover = () =\u0026gt; { debounce.exec(() =\u0026gt; { const curType = $e.dataset.type marks.forEach(mark =\u0026gt; { if (curType \u0026amp;\u0026amp; mark.dataset.type === curType) { mark.style.opacity = 1 mark.style.zIndex = 10 + parseInt(mark.style.zIndex) $bg.innerText = curType } else { mark.style.opacity = .1 } }) $e.style.opacity = 1 $e.style.zIndex = 21 }) } $e.onmouseout = () =\u0026gt; { debounce.cancel() marks.forEach(mark =\u0026gt; { mark.style.opacity = .8 mark.style.zIndex = 11 - mark.dataset.score }) $bg.innerText = Config.title } }) $style.innerHTML = genCSS() + ` #my-tags { overflow-x: hidden; padding: 7%; text-align: center; width: 100%; height: 100%; position: relative; box-sizing: border-box; z-index: 2;} #my-tags a::after { content: \u0026#34;🎐\u0026#34;; } #my-tags a:hover::after { animation: move .3s linear infinite; position: relative; } #my-tags mark { position: absolute; padding: .3em .4em; display: inline-block; border-radius: em; margin: .2em .3em .5em .5em; opacity: .8; transition: opacity .2s; box-shadow: 0.3px 0.5px 5px #111;border-style: double;} @media (max-width: 1000px) { #my-tags mark { animation: none !important; } } @media (max-width: 600px) { #my-tags mark { position: unset; } html { overflow-x: hidden; font-size: 10px; } } @keyframes move { 0% { left: 0px } 50% { left: 1% } 100 { left: 0px } } @keyframes float { 0% { transform: translatey(0px) rotate(0deg); } 15% { transform: translatey(-3%) rotate(4deg); } 30% { transform: translatey(-5%) rotate(7deg); } 45% { transform: translatey(-2%) rotate(4deg); } 60% { transform: translatey(2%) rotate(-2deg); } 75% { transform: translatey(5%) rotate(-6deg); } 90% { transform: translatey(3%) rotate(-3deg); } 100% { transform: translatey(0px) rotate(0deg); } } @keyframes float-reverse { 0% { transform: translatey(0px) rotate(0deg); } 15% { transform: translatey(3%) rotate(-4deg); } 30% { transform: translatey(5%) rotate(-7deg); } 45% { transform: translatey(2%) rotate(-4deg); } 60% { transform: translatey(-2%) rotate(2deg); } 75% { transform: translatey(-5%) rotate(6deg); } 90% { transform: translatey(-3%) rotate(3deg); } 100% { transform: translatey(0px) rotate(0deg); } } ` } 添加强调 shortcode 在 layouts\\shortcodes 添加 mark.html 如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 {{ $color := .Get \u0026#34;color\u0026#34; }} \u0026lt;span class=\u0026#34;mark_{{ $color }}\u0026#34;\u0026gt; {{ .Inner }} \u0026lt;/span\u0026gt; \u0026lt;style\u0026gt; .mark_{{ $color }} { background: repeating-linear-gradient(-45deg, var(--color_mark_{{ $color }}), var(--color_mark_{{ $color }}) 2px, transparent 2px, transparent 4px) no-repeat 0 0.95em; display: inline; padding: 2px; font-weight: bold; } :root { --color_mark_blue: #b7e3ff; --color_mark_green: #bdf9c3; --color_mark_yellow: #fcf69f; --color_mark_orange: #ffddbc; } \u0026lt;/style\u0026gt; 示例如下：\n示例文字1 示例文字1 示例文字1 示例文字1 插入豆瓣电影页 添加 layouts\\_default\\movies.html ，内容如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 {{ define \u0026#34;main\u0026#34; }} \u0026lt;meta name=\u0026#34;referrer\u0026#34; content=\u0026#34;no-referrer\u0026#34;\u0026gt; \u0026lt;style\u0026gt; .post-film{ grid-area: 2/1/span 2/span 2;\tpadding: 7%; } \u0026lt;/style\u0026gt; \u0026lt;div class=\u0026#34;post-film\u0026#34;\u0026gt; \u0026lt;style\u0026gt; .gFnzgG,.gFnzgG *{box-sizing:border-box} .fIuTG{display:flex;flex-wrap:wrap;margin:0 -2%;background:0 0;line-height:100%} .dfdORB{width:16%;margin:0 2% 30px;padding:0;font-size:15px} .dfdORB a{text-decoration:none} .kMthTr{margin-top:12px;line-height:1.3;max-height:3rem;overflow:hidden;font-size: 12px} .eysHZq{display:flex;-webkit-box-align:center;align-items:center;margin-top:5px;min-height:16px;line-height:1} .HPRth{position:relative;min-height:87px;overflow:hidden;color:transparent} .HPRth:hover{box-shadow:rgb(48 55 66 / 30%) 0 1rem 2.1rem} .jcTaHb{display:flex;-webkit-box-align:center;align-items:center} .lhtmRw{margin-right:1px;width:12px;height:12px;color:#fccd59} .gaztka{margin-right:1px;width:12px;height:12px;color:#eee} .iibjPt{margin-left:5px;color:#555;font-size:14px} .jvCTkj{margin-bottom:10px} .kEoOHR{display:inline-block;margin-right:15px;text-decoration:none;color:#157efb} .dvtjjf{display:inline-block;color:#555;text-decoration:none;padding:0 5px} .dvtjjf.active{background:rgba(85,85,85,.1)} .hide{display:none} .sort-by{text-align:right;margin-top:-15px} .sort-by-item{margin-left:10px;padding:0 5px;line-height:20px} .sort-by-item.active{background:rgba(85,85,85,.1)} .sort-by-item svg{margin-right:5px} .sc-hKFxyN img{max-width:100%!important;height:auto!important;display:block!important;vertical-align:middle!important} @media(min-width:1024px){ .lg\\:col-span-6{grid-column:span 6/span 6!important} .lg\\:col-start-2{grid-column-start:2!important} } @media (max-width:769px){ .jcTaHb,.sc-bdnxRM{display:none} .rating .allstardark{display:none} .kMthTr{margin-top:5px} .dfdORB{width:21%!important} } .rating .allstardark { position: relative; color: #f99b01; height: 16px; width: 80px; background-size: auto 100%; margin-right: 8px; background-repeat: repeat; background-image: url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxwYXRoIGQ9Ik05MDguMSAzNTMuMWwtMjUzLjktMzYuOUw1NDAuNyA4Ni4xYy0zLjEtNi4zLTguMi0xMS40LTE0LjUtMTQuNS0xNS44LTcuOC0zNS0xLjMtNDIuOSAxNC41TDM2OS44IDMxNi4ybC0yNTMuOSAzNi45Yy03IDEtMTMuNCA0LjMtMTguMyA5LjMtMTIuMyAxMi43LTEyLjEgMzIuOS42IDQ1LjNsMTgzLjcgMTc5LjEtNDMuNCAyNTIuOWMtMS4yIDYuOS0uMSAxNC4xIDMuMiAyMC4zIDguMiAxNS42IDI3LjYgMjEuNyA0My4yIDEzLjRMNTEyIDc1NGwyMjcuMSAxMTkuNGM2LjIgMy4zIDEzLjQgNC40IDIwLjMgMy4yIDE3LjQtMyAyOS4xLTE5LjUgMjYuMS0zNi45bC00My40LTI1Mi45IDE4My43LTE3OS4xYzUtNC45IDguMy0xMS4zIDkuMy0xOC4zIDIuNy0xNy41LTkuNS0zMy43LTI3LTM2LjN6TTY2NC44IDU2MS42bDM2LjEgMjEwLjNMNTEyIDY3Mi43IDMyMy4xIDc3MmwzNi4xLTIxMC4zLTE1Mi44LTE0OUw0MTcuNiAzODIgNTEyIDE5MC43IDYwNi40IDM4MmwyMTEuMiAzMC43LTE1Mi44IDE0OC45eiIgZmlsbD0iI2Y5OWIwMSIvPjwvc3ZnPg==); } .rating { margin: 0 0 5px; font-size: 13px; line-height: 1; display: flex; align-items: center; }\t.post-title{margin-bottom:10px} .sc-bdnxRM{margin-bottom:5px} \u0026lt;/style\u0026gt; \u0026lt;h2 class=\u0026#34;post-title\u0026#34;\u0026gt;{{.Title}}\u0026lt;/h2\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; function search(e) { document.querySelectorAll(\u0026#39;.dfdORB\u0026#39;).forEach(item =\u0026gt; item.classList.add(\u0026#39;hide\u0026#39;)); document.querySelector(`.dvtjjf.active[data-search=\u0026#34;${e.target.dataset.search}\u0026#34;]`)?.classList.remove(\u0026#39;active\u0026#39;); if(e.target.dataset.value) { e.target.classList.add(\u0026#39;active\u0026#39;); } const searchItems = document.querySelectorAll(\u0026#39;.dvtjjf.active\u0026#39;); const attributes = Array.from(searchItems, searchItem =\u0026gt; { const property = `data-${searchItem.dataset.search}`; const logic = searchItem.dataset.method === \u0026#39;contain\u0026#39; ? \u0026#39;*\u0026#39; : \u0026#39;^\u0026#39;; const value = searchItem.dataset.method === \u0026#39;contain\u0026#39; ? `${searchItem.dataset.value}` : searchItem.dataset.value; return `[${property}${logic}=\u0026#39;${value}\u0026#39;]`; }); const selector = `.dfdORB${attributes.join(\u0026#39;\u0026#39;)}`; document.querySelectorAll(selector).forEach(item =\u0026gt; item.classList.remove(\u0026#39;hide\u0026#39;)); } window.addEventListener(\u0026#39;click\u0026#39;, function(e) { if(e.target.classList.contains(\u0026#39;sc-gtsrHT\u0026#39;)) { e.preventDefault(); search(e); } }); function sort(e) { const sortBy = e.target.dataset.order; const style = document.createElement(\u0026#39;style\u0026#39;); style.classList.add(\u0026#39;sort-order-style\u0026#39;); document.querySelector(\u0026#39;style.sort-order-style\u0026#39;)?.remove(); document.querySelector(\u0026#39;.sort-by-item.active\u0026#39;)?.classList.remove(\u0026#39;active\u0026#39;); e.target.classList.add(\u0026#39;active\u0026#39;); if(sortBy === \u0026#39;rating\u0026#39;) { const items = Array.from(document.querySelectorAll(\u0026#39;.dfdORB\u0026#39;)); items.sort((itemA, itemB) =\u0026gt; { const ratingA = parseFloat(itemA.dataset.rating) || 0; const ratingB = parseFloat(itemB.dataset.rating) || 0; if(ratingA === ratingB) { return 0; } return ratingA \u0026gt; ratingB ? -1 : 1; }); const stylesheet = items.map((item, idx) =\u0026gt; `.dfdORB[data-rating=\u0026#34;${item.dataset.rating}\u0026#34;] { order: ${idx}; }`).join(\u0026#39;\\r\\n\u0026#39;); style.innerHTML = stylesheet; document.body.appendChild(style); } } window.addEventListener(\u0026#39;click\u0026#39;, function(e) { if(e.target.classList.contains(\u0026#39;sort-by-item\u0026#39;)) { e.preventDefault(); sort(e); } }); \u0026lt;/script\u0026gt; \u0026lt;div class=\u0026#34;lg:col-start-2 lg:col-span-6\u0026#34;\u0026gt; {{$items := getCSV \u0026#34;,\u0026#34; \u0026#34;static/movie.csv\u0026#34; }} \u0026lt;div class=\u0026#34;sc-ksluID gFnzgG\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;sc-bdnxRM\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sc-gtsrHT kEoOHR\u0026#34; data-search=\u0026#34;year\u0026#34; data-method=\u0026#34;equal\u0026#34; data-value=\u0026#34;\u0026#34;\u0026gt;全部\u0026lt;/a\u0026gt; {{range $year := (seq now.Year -1 2012)}} \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sc-gtsrHT dvtjjf\u0026#34; data-search=\u0026#34;year\u0026#34; data-method=\u0026#34;equal\u0026#34; data-value=\u0026#34;{{$year}}\u0026#34;\u0026gt;{{$year}}\u0026lt;/a\u0026gt; {{end}} \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;sc-bdnxRM\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sc-gtsrHT kEoOHR\u0026#34; data-search=\u0026#34;star\u0026#34; data-method=\u0026#34;equal\u0026#34; data-value=\u0026#34;\u0026#34;\u0026gt;全部\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sc-gtsrHT dvtjjf\u0026#34; data-search=\u0026#34;star\u0026#34; data-method=\u0026#34;equal\u0026#34; data-value=\u0026#34;5\u0026#34;\u0026gt;五星\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sc-gtsrHT dvtjjf\u0026#34; data-search=\u0026#34;star\u0026#34; data-method=\u0026#34;equal\u0026#34; data-value=\u0026#34;4\u0026#34;\u0026gt;四星\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sc-gtsrHT dvtjjf\u0026#34; data-search=\u0026#34;star\u0026#34; data-method=\u0026#34;equal\u0026#34; data-value=\u0026#34;3\u0026#34;\u0026gt;三星\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sc-gtsrHT dvtjjf\u0026#34; data-search=\u0026#34;star\u0026#34; data-method=\u0026#34;equal\u0026#34; data-value=\u0026#34;2\u0026#34;\u0026gt;二星\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sc-gtsrHT dvtjjf\u0026#34; data-search=\u0026#34;star\u0026#34; data-method=\u0026#34;equal\u0026#34; data-value=\u0026#34;1\u0026#34;\u0026gt;一星\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sc-gtsrHT dvtjjf\u0026#34; data-search=\u0026#34;star\u0026#34; data-method=\u0026#34;equal\u0026#34; data-value=\u0026#34;0\u0026#34;\u0026gt;零星\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;jvCTkj sort-by\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sort-by-item active\u0026#34; data-order=\u0026#34;time\u0026#34;\u0026gt;时间排序\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:void 0;\u0026#34; class=\u0026#34;sort-by-item\u0026#34; data-order=\u0026#34;rating\u0026#34;\u0026gt;评分排序\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;sc-dIsUp fIuTG\u0026#34;\u0026gt; {{range $idx,$item := $items}} {{if ne $idx 0}} {{ $rating := float (index $item 6)}} {{ $coverSrc := index $item 5 }} {{ $douURL := replaceRE \u0026#34;https://movie.douban.com/subject/([0-9]+)/\u0026#34; \u0026#34;https://dou.img.lithub.cc/movie/$1.jpg\u0026#34; $coverSrc}} \u0026lt;div class=\u0026#34;sc-gKAaRy dfdORB\u0026#34; data-year=\u0026#34;{{index $item 11}}\u0026#34; data-star=\u0026#34;{{index $item 8}}\u0026#34; data-rating=\u0026#34;{{$rating}}\u0026#34; data-genres=\u0026#34;{{index $item 7}}\u0026#34; \u0026gt; \u0026lt;div class=\u0026#34;sc-hKFxyN HPRth\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;lazyload-wrapper\u0026#34;\u0026gt; \u0026lt;img class=\u0026#34;avatar\u0026#34; src=\u0026#34;{{ $douURL }}\u0026#34; referrer-policy=\u0026#34;no-referrer\u0026#34; decoding=\u0026#34;async\u0026#34; loading=\u0026#34;lazy\u0026#34; alt=\u0026#34;{{ index $item 9 }}\u0026#34; title=\u0026#34;{{ index $item 1 }}\u0026#34; width=\u0026#34;150\u0026#34; height=\u0026#34;220\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;sc-fujyAs eysHZq\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;rating\u0026#34;\u0026gt;\u0026lt;span class=\u0026#34;allstardark\u0026#34;\u0026gt;\u0026lt;span class=\u0026#34;allstarlight\u0026#34; style=\u0026#34;width:{{mul 10 $rating }}%\u0026#34;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026#34;rating_nums\u0026#34;\u0026gt;{{$rating}}\u0026lt;/span\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;sc-iCoGMd kMthTr\u0026#34;\u0026gt;\u0026lt;a rel=\u0026#34;link\u0026#34; href=\u0026#34;{{ index $item 5 }}\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;{{ index $item 1 }}\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {{end}} {{end}} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {{ end }} 然后添加 content\\movies.md\nmarkdown语法增强 在 _custom.js 中添加如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // 获取所有 \u0026lt;blockquote\u0026gt; 元素下的 \u0026lt;p\u0026gt; 元素 const blockquotePs = document.querySelectorAll(\u0026#39;blockquote p\u0026#39;); // 遍历每个 \u0026lt;p\u0026gt; 元素 blockquotePs.forEach(item =\u0026gt; { let _innerHtml = item.innerHTML; // 检查是否以 \u0026#39;::\u0026#39; 开头 if (_innerHtml.indexOf(\u0026#39;::\u0026#39;) === 0) { // 设置父节点的 class 为 \u0026#39;oh-essay\u0026#39; item.parentNode.setAttribute(\u0026#39;class\u0026#39;, \u0026#39;oh-essay\u0026#39;); // 将当前 \u0026lt;p\u0026gt; 元素替换为包含在 \u0026lt;div\u0026gt; 中的内容 item.outerHTML = `\u0026lt;div\u0026gt;${_innerHtml.slice(2)}\u0026lt;/div\u0026gt;`; } }); 在 _custom.scss 中添加如下\n1 2 3 4 5 6 7 8 .oh-essay { \u0026amp;:before { content: \u0026#39;💭\u0026#39;; //\u0026#39;💭\u0026#39;; //\u0026#39;💬\u0026#39;; //\u0026#39;🗨️\u0026#39;; float: left; padding-right: 8px; } background: #cccfd465; } 这样当输入 \u0026gt;:: 的时候显示如下：\n::注意\n添加notice表情包 在 shortcodes 文件夹下添加 notice.html ，内容如下：\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;style\u0026gt; .image-emoji img { display: inline !important;\t//vertical-align: middle; margin: 0 0 -5px 0; } \u0026lt;/style\u0026gt; \u0026lt;span class=\u0026#34;image-emoji\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;/emoji/notice.gif\u0026#34; title=\u0026#34;ablobcouncil\u0026#34; alt=\u0026#34;ablobcouncil\u0026#34; width=\u0026#34;28px\u0026#34; height=\u0026#34;auto\u0026#34;\u0026gt; {{.Inner}} \u0026lt;/span\u0026gt; 效果： 注意事项\n代码块折叠 添加 codeblock.js 代码，内容如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 document.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, () =\u0026gt; { CodeBlock.init(); }); const CodeBlock = { maxHeight: 450, // px maxLines: 20, initCodeBlockOverflowY: function (overflowHeight) { overflowHeight = overflowHeight || CodeBlock.maxHeight; const codeBlocks = document.querySelectorAll(\u0026#39;.highlight\u0026#39;); codeBlocks.forEach((codeBlock) =\u0026gt; { const chromaElement = codeBlock.querySelector(\u0026#39;.chroma\u0026#39;); const originalHeight = chromaElement.offsetHeight; const lines = codeBlock.getElementsByClassName(\u0026#39;line\u0026#39;); const numLines = lines.length; //console.log(\u0026#39;未折叠前行数：\u0026#39;, numLines);\tif (numLines \u0026gt; CodeBlock.maxLines) { chromaElement.style.maxHeight = overflowHeight + \u0026#39;px\u0026#39;; chromaElement.style.overflow = \u0026#39;hidden\u0026#39;; const showMoreDiv = document.createElement(\u0026#39;div\u0026#39;); showMoreDiv.style.cssText = \u0026#39;text-align: center;margin-top: -18px;cursor: pointer;\u0026#39;; showMoreDiv.innerHTML = \u0026#39;\u0026lt;i class=\u0026#34;fa-solid fa-angles-down fa-beat-fade\u0026#34; style=\u0026#34;font-size: 12px;\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026#39;; showMoreDiv.querySelector(\u0026#39;i\u0026#39;).style.color = \u0026#39;#a19e98\u0026#39;;\t//修改箭头图标颜色\tcodeBlock.appendChild(showMoreDiv); showMoreDiv.addEventListener(\u0026#39;click\u0026#39;, function () { if (showMoreDiv.innerHTML.indexOf(\u0026#39;fa-angles-down\u0026#39;) \u0026gt; 0) { chromaElement.style.maxHeight = originalHeight + \u0026#39;px\u0026#39;; showMoreDiv.innerHTML = \u0026#39;\u0026lt;i class=\u0026#34;fa-solid fa-angles-up fa-beat-fade\u0026#34; style=\u0026#34;font-size: 12px;\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026#39;; } else { chromaElement.style.maxHeight = overflowHeight + \u0026#39;px\u0026#39;; showMoreDiv.innerHTML = \u0026#39;\u0026lt;i class=\u0026#34;fa-solid fa-angles-down fa-beat-fade\u0026#34; style=\u0026#34;font-size: 12px;\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026#39;; showMoreDiv.querySelector(\u0026#39;i\u0026#39;).style.color = \u0026#39;#a19e98\u0026#39;;\t//修改箭头图标颜色\t} }); } }); }, init: function () { this.initCodeBlockOverflowY(); } }; 然后引入 all.min.css 并且在 static 文件夹里面添加 webfonts 文件夹来实现 Font Awesome 的图标显示\n修改手机archive页面 修改 left 属性即可调整位置\n在 _custom.scss 中添加如下：\n1 2 3 4 5 6 7 8 9 10 @media only screen and (max-width: 768px) { .archive__title:hover[data-dir=\u0026#34;ltr\u0026#34;]::before, .archive__title:active[data-dir=\u0026#34;ltr\u0026#34;]::before, .archive__title:focus[data-dir=\u0026#34;ltr\u0026#34;]::before{ left: 68px !important;\t} } @media only screen and (max-width: 768px) { .theme__light .archive__title:hover[data-dir=\u0026#34;ltr\u0026#34;]::before, .theme__light .archive__title:active[data-dir=\u0026#34;ltr\u0026#34;]::before, .theme__light .archive__title:focus[data-dir=\u0026#34;ltr\u0026#34;]::before { top: 12px !important;\t} } 修改后如下：\n文章加密 待实现\n","description":"本文主要记录 zzo 主题的修复以及一些优化","id":5,"section":"hugo","tags":["hugo"],"title":"博客优化","uri":"https://ayuxy.github.io/zh/hugo/2023-1120-01/"}]